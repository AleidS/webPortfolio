<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
    integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
    crossorigin="anonymous"></script>
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script src="script/script.js">
</script>

<!-- TYPING EFFECTS -> TEXTILLATE -->
<!-- https://github.com/jschr/textillate (MIT) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/textillate/0.4.0/jquery.textillate.min.js"
    integrity="sha512-0bHMhYsdpiur1bT84kDH4D7cpxFQ9O7uA5yxVAqWC87h552Xt0swX4M+ZlXMKE8oPVRIJ5lAwXWO2UWeDwJJOw=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<!-- Dependencies textillate; 
    1. lettering.js (WTFPL licence) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/lettering.js/0.6.1/jquery.lettering.min.js"
    integrity="sha512-VJ/iYbiu1eJ6yLimfTi65t2R9TFcG5D9X8ZCfbbEFhTfPnKJh8byoKXEawi5ScJZBYL1eiirL1+MczZDx0Tz9Q=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<!-- Anime library for text effects  https://tobiasahlin.com/moving-letters/#10-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/2.0.2/anime.min.js"></script>

<!-- Swiper image gallery -->
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<!-- Font awesome -->
<script src="https://kit.fontawesome.com/e7c36fd275.js" crossorigin="anonymous"></script>

<!-- Lazy image loading  -->
<script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.8.4/dist/lazyload.min.js"></script>

<!-- Fit text to width -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/FitText.js/1.2.0/jquery.fittext.min.js"
    integrity="sha512-e2WVdoOGqKU97DHH6tYamn+eAwLDpyHKqPy4uSv0aGlwDXZKGwyS27sfiIUT8gpZ88/Lr4UZpbRt93QkGRgpug=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>

    // Textillate
    // $(function () {
    //     $('.tlt').textillate({
    //         // in animation settings
    //         in: {
    //             // set the effect name
    //             effect: 'fadeInLeft',

    //             // set the delay factor applied to each consecutive character
    //             delayScale: 1.0,

    //             // set the delay between each character
    //             delay: 100,

    //             // set to true to animate all the characters at the same time
    //             sync: false,

    //             // randomize the character sequence
    //             // (note that shuffle doesn't make sense with sync = true)
    //             shuffle: false,

    //             // reverse the character sequence
    //             // (note that reverse doesn't make sense with sync = true)
    //             reverse: false,

    //             // callback that executes once the animation has finished
    //             callback: function () { }
    //         },
    //     });
    // })

    $(".navbar-collapse a").click(function () {
        $("#navbarCollapse").collapse("hide");
    });
    $("#navbarDropdownMenuLink").click(function () {
        $("#navbarCollapse").collapse("hide");
    });
    $('document').ready(function () {
        $(window).scrollTop(-400);
        AOS.init({
            duration: 800,
        });
    });

    var string = `Portfolio`;
    var array = string.split("");
    var string2 = `Web development by Aleid`;
    var array2 = string2.split("");
    var timer;
    var timer2;
    let shownPassword = false;

    // If there's websites with passwords, use this to show how to access
    // $(".projectLink").on('click', function (event) {
    //     if (shownPassword == false) {
    //         alert('PLEASE NOTE: Username: portfolio, password: portfolio');
    //         shownPassword = true;
    //     }
    //     else {
    //         return;
    //     }
    // });

    // Typing effect
    function frameLooper() {
        if (array.length > 0) {
            document.getElementById("title").innerHTML += array.shift();
        } else {
            clearTimeout(timer);
            // When finished, type subtitle
            frameLooper2();
        }
        loopTimer = setTimeout('frameLooper()', 70);
    }
    // Subtitle typing effect
    function frameLooper2() {
        if (array2.length > 0) {
            document.getElementById("subtitle").innerHTML += array2.shift();
        } else {
            clearTimeout(timer2);
        }
        loopTimer = setTimeout('frameLooper2()', 70);
    }
    function showMenu() {
        var x = document.getElementById("expandMenu");
        if (x.style.display === "none") {
            x.style.display = "flex";
        } else {
            x.style.display = "none";
        }
    }
    function showElement(element2, id) {
        var x2 = document.getElementById(element2);
        if (x2.style.display != "block") {
            x2.style.display = "block";
            document.getElementById(id).classList.remove('fa-plus-circle')
            document.getElementById(id).classList.add('fa-minus-circle')
        } else {
            x2.style.display = "none";
            if (id) {
                document.getElementById(id).classList.remove('fa-minus-circle')
                document.getElementById(id).classList.add('fa-plus-circle')
            }
        }
        $("nav").find("li").on("click", "a", function () {
            $('.navbarCollapse').collapse('hide');
        });
    }

    function show3D(id) {
        const bound = document.getElementById(`${id}-bound`)
        // document.getElementById(`${id}-bound`).style.display = 'block';
        const contents = document.getElementById(`${id}-card`).getElementsByClassName('contents')[0]
        // document.getElementById(`${id}-card`).getElementsByClassName('contents')[0].style.height = '0px';
        anime.timeline({ loop: false })
            .add({
                targets: contents,
                height: 0,
                opacity: 0,
                duration: 500,
                easing: 'easeInOutSine'
            })
        anime.timeline({ loop: false })
            .add({
                targets: bound,
                height: 5000,
                opacity: 1,
                duration: 500,
                easing: 'easeInOutSine'
            })
    }
    frameLooper();

    // var string3 = `This is testing`;
    // var array3 = string3.split("");

    let arrayGlobal = []
    function typingEffect3(arrayX, card) {
        if (arrayGlobal.length > 0) {
            card.innerHTML += arrayGlobal.shift();

        }
    }



    // frameLooper3()
    // Lazy image loader
    var lazyLoadInstance = new LazyLoad({
    });

    // increase opacity/size of explanations when scrolling (mobile view)
    // https://alvarotrigo.com/blog/css-animations-scroll/
    window.addEventListener('load', function () {


        let tltshown = []
        var txts = document.getElementsByClassName('txt');
        for (var i = 0; i < txts.length; i++) {
            // Wraps each word, rather than each character (otherwise get stange word-breaks)
            txts[i].innerHTML = txts[i].textContent.replace(/\S+/g, "<span class='letter'>$&</span>");
            // txts[i].innerHTML = txts[i].textContent.replace(/\S/g, "<span class='letter'>$&</span>");
        }
        function reveal() {
            var explanations = document.querySelectorAll(".explanation");
            var tlts = document.querySelectorAll(".tlt");
            var projectCards = document.querySelectorAll(".projectCard");
            var projectTools = document.querySelectorAll(".projectCard li");
            var windowHeight = window.innerHeight;
            var windowWidth = window.innerWidth;

            for (var i = 0; i < projectTools.length; i++) {
                var elementTop = projectTools[i].getBoundingClientRect().top;
                var elementVisible = 10;
                var windowHeight = window.innerHeight;
                var windowWidth = window.innerWidth;
                // var percentage = Math.min(((windowHeight - elementTop) / (windowHeight * 0.4)), 1)
                if (elementTop < windowHeight - elementVisible) {
                    projectTools[i].classList.add("active");
                    // projectTools[i].innerHTML = i
                } else {
                    projectTools[i].classList.remove("active");
                }
                // console.log(elementTop);
                // projectTools[i].style.transform = `translateX(${(-200 + (percentage * 200))}px)`;
                // console.log(percentage)

                // projectCards[i].style.transform = `scaleY(calc(min(${percentage},1)))rotateX(${percentage * 90}deg)`;
                // projectCards[i].style.scale = `${Math.cos((elementTop * 1.4 - 300) / 500)}`;
            }
            for (var i = 0; i < projectCards.length; i++) {
                var projectTool = projectCards[i].querySelectorAll("li");
                for (var i = 0; i < projectTool.length; i++) {
                    projectTool[i].style.transitionDelay = (`${(i / 3)}s`);
                }
            }

            for (var i = 0; i < explanations.length; i++) {
                var elementTop = explanations[i].getBoundingClientRect().top;
                var elementVisible = 150;
                // if (elementTop < windowHeight - elementVisible) {
                //     explanations[i].classList.add("active");
                // } else {
                //     explanations[i].classList.remove("active");
                // }
                if ((windowWidth / windowHeight) < (5 / 8)) {
                    explanations[i].style.opacity = `${1 - ((elementTop - 200) / (windowHeight - 500))}`;
                    explanations[i].style.scale = `${Math.cos((elementTop * 1.4 - 300) / 500)}`;
                }
                // If someone is resizing window from narrow->large, reset (otherwise they're all invisible)
                else {
                    explanations[i].style.opacity = `${1}`;
                    explanations[i].style.scale = `${1}`;
                }
            }
            for (var i = 0; i < tlts.length; i++) {
                var elementTop = tlts[i].getBoundingClientRect().top;
                var elementVisible = 30;
                tlts[i].setAttribute("id", `tlt${i}`);
                // var elementID = tlts[i].id
                if (elementTop < windowHeight - elementVisible) {
                    if (tltshown[i] != true) {
                        // https://tobiasahlin.com/moving-letters/#10
                        tlts[i].innerHTML = tlts[i].textContent.replace(/\S/g, "<span class='letter'>$&</span>");
                        anime.timeline({ loop: false })
                            .add({
                                targets: '.ml10 .letter',
                                translateY: [-20, 0],
                                opacity: [0, 1],
                                duration: 500,
                                easing: 'easeInOutSine',
                                delay: (el, i) => 20 * i
                            })

                        // Textilate messed up alignment of text
                        // $(`#tlt${i}`).textillate('start');
                        tltshown[i] = true
                    }
                    // console.log(`yay ${ i }`)
                }

            }

        }
        window.addEventListener("scroll", reveal);
        window.addEventListener("resize", reveal);
        let loaded = 0;
        let smallestSize = false
        // window.addEventListener("resize", () => {
        //     if (loaded == 3) {
        //         console.log("👋yes, it's very responsive indeed. ")
        //     }
        //     if (window.innerWidth < 250 && smallestSize == false) {
        //         console.log("😅now, let's not get ridiculous here")
        //         smallestSize = true
        //     }
        //     loaded += 1;
        // })

        reveal();
        // <!-- Initialize swiper -->


        allCards = document.getElementsByClassName('projectCard')

        for (var i = 0; i < allCards.length; i++) {
            const img = allCards[i].getElementsByClassName('swiperImg')[0];
            const txt = allCards[i].getElementsByClassName('swiperText')[0];
            const txtShown = [[], [], [], [], [], []]
            let horizontal = false
            // txt.getElementsByClassName('letter')[0].style.opacity = '1'
            const swiper = new Swiper(img, {
                // Optional parameters
                direction: 'horizontal',
                // loop: true,
                effect: 'coverflow',
                mousewheelControl: true,
                mousewheel: true,
                keyboardControl: true,
                delay: 5000,
                // If we need pagination
                pagination: {
                    el: '.swiper-pagination',
                },

                // Navigation arrows
                navigation: {
                    nextEl: img.getElementsByClassName('swiper-button-next')[0],
                    prevEl: img.getElementsByClassName('swiper-button-prev')[0],
                },

                // And if we need scrollbar
                scrollbar: {
                    el: '.swiper-scrollbar',
                },

                on: {
                    transitionStart: function () {

                        var videos = img.querySelectorAll('video');

                        Array.prototype.forEach.call(videos, function (video) {
                            video.pause();
                        });
                    },
                    transitionEnd: function () {
                        var activeIndex = this.activeIndex;
                        var activeSlide = img.getElementsByClassName('swiper-slide')[activeIndex];
                        var activeSlideVideo = activeSlide.getElementsByTagName('video')[0];
                        if (activeSlideVideo != null) {
                            activeSlideVideo.play();
                        }
                    },

                    slideChange: function () {
                        var activeIndex = this.activeIndex;
                        var activeSlide = img.getElementsByClassName('swiper-slide')[activeIndex];
                        var activeText = txt.getElementsByClassName('pContainer')[activeIndex];
                        var activeTxts = activeText.getElementsByClassName('txt');
                        for (var i = 0; i < activeTxts.length; i++) {
                            // https://tobiasahlin.com/moving-letters/#10

                            if (txtShown[activeIndex][i] == undefined && activeIndex != 0) {
                                anime.timeline({ loop: false })
                                    .add({
                                        targets: (txt.getElementsByClassName('ml10'), txt.getElementsByClassName('letter')),
                                        translateX: [0, 0],
                                        opacity: [0, 1],
                                        duration: 1000,
                                        easing: 'easeInOutSine',
                                        delay: (el, i) => 80 * i
                                    })
                                txtShown[activeIndex][i] += 1

                            }
                            if (txtShown[activeIndex][i] == undefined) {
                                txtShown[activeIndex][i] = 0
                            }

                        }

                    },

                }
            });

            const swiperText = new Swiper(txt, {
                // Optional parameters
                direction: 'horizontal',
                // loop: true,
                effect: 'slide',
                mousewheelControl: true,
                keyboardControl: true,

                // If we need pagination
                pagination: {
                    el: img.getElementsByClassName('.swiper-pagination')[0],
                },


                // And if we need scrollbar
                scrollbar: {
                    el: '.swiper-scrollbar',
                },

            });
            // Syncs also the touch moves!
            swiperText.controller.control = swiper;
            swiper.controller.control = swiperText;

        }
        screens = document.getElementsByClassName('verticalScrollScreen')


        // show obstruction screen when scrolling in horizontal direction
        document.addEventListener('wheel', e => {
            // When scrolling direction is horizontal, hide screens so that controls can be used

            // When scrolling is vertical, show screens
            if (Math.abs(e.deltaY) > (Math.abs(e.deltaX) * 0.5)) {
                for (var i = 0; i < screens.length; i++) {
                    screens[i].style.opacity = "1";
                    screens[i].style.display = "block";
                    screens[i].style.pointerEvents = "auto";

                }
            }
            else {
                for (var i = 0; i < screens.length; i++) {
                    screens[i].style.opacity = "0";
                    screens[i].style.display = "none";
                    screens[i].style.pointerEvents = "none";
                }
            }
        })
        // Hide obstruction on click events
        document.addEventListener('click', e => {
            for (var i = 0; i < screens.length; i++) {
                screens[i].style.opacity = "0";
                screens[i].style.display = "none";
                screens[i].style.pointerEvents = "none";
            }
            // Re-do the click event
            // document.elementFromPoint(e.x, e.y).click();
        })
        document.addEventListener('touchmove', e => {

            for (var i = 0; i < screens.length; i++) {
                screens[i].style.opacity = "0";
                screens[i].style.display = "none";
                screens[i].style.pointerEvents = "none";
            }
        })
        document.addEventListener('mousemove', e => {

            for (var i = 0; i < screens.length; i++) {
                screens[i].style.opacity = "0";
                screens[i].style.display = "none";
                screens[i].style.pointerEvents = "none";
            }
        })

    })


</script>